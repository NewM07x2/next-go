# GraphQL API ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€GraphQL + REST API ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
go-app/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ main.go              # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ internal/                    # å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆå¤–éƒ¨ã‹ã‚‰åˆ©ç”¨ä¸å¯ï¼‰
â”‚   â”œâ”€â”€ config/                  # è¨­å®šç®¡ç†
â”‚   â”‚   â””â”€â”€ config.go
â”‚   â”œâ”€â”€ domain/                  # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰
â”‚   â”‚   â””â”€â”€ task.go
â”‚   â”œâ”€â”€ handler/                 # REST APIãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ health.go
â”‚   â”‚   â”œâ”€â”€ health_test.go
â”‚   â”‚   â”œâ”€â”€ task.go
â”‚   â”‚   â””â”€â”€ task_test.go
â”‚   â”œâ”€â”€ repository/              # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
â”‚   â”‚   â”œâ”€â”€ task_repository.go            # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚   â””â”€â”€ task_repository_memory.go     # In-Memoryå®Ÿè£…
â”‚   â”œâ”€â”€ service/                 # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”‚   â””â”€â”€ task_service.go
â”‚   â”œâ”€â”€ router/                  # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
â”‚   â”‚   â””â”€â”€ router.go
â”‚   â””â”€â”€ infrastructure/          # å¤–éƒ¨ä¾å­˜ï¼ˆDBç­‰ï¼‰
â”‚       â””â”€â”€ database/
â”‚           â””â”€â”€ postgres.go      # PostgreSQLæ¥ç¶šï¼ˆä»Šå¾Œå®Ÿè£…ï¼‰
â”œâ”€â”€ pkg/                         # å¤–éƒ¨å…¬é–‹å¯èƒ½ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”‚   â””â”€â”€ graph/                   # GraphQLé–¢é€£
â”‚       â”œâ”€â”€ gqlgen.yml           # gqlgenè¨­å®š
â”‚       â”œâ”€â”€ schema/
â”‚       â”‚   â””â”€â”€ schema.graphql   # GraphQLã‚¹ã‚­ãƒ¼ãƒå®šç¾©
â”‚       â”œâ”€â”€ resolver/
â”‚       â”‚   â”œâ”€â”€ resolver.go      # ãƒªã‚¾ãƒ«ãƒãƒ¼åŸºåº•
â”‚       â”‚   â””â”€â”€ schema.resolvers.go  # ç”Ÿæˆã•ã‚Œã‚‹ãƒªã‚¾ãƒ«ãƒãƒ¼
â”‚       â”œâ”€â”€ model/
â”‚       â”‚   â”œâ”€â”€ model.go         # ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«
â”‚       â”‚   â””â”€â”€ models_gen.go    # ç”Ÿæˆã•ã‚Œã‚‹ãƒ¢ãƒ‡ãƒ«
â”‚       â””â”€â”€ generated/
â”‚           â””â”€â”€ generated.go     # gqlgenç”Ÿæˆã‚³ãƒ¼ãƒ‰
â”œâ”€â”€ docs/                        # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â””â”€â”€ ARCHITECTURE.md          # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ .air.toml                    # ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰è¨­å®š
â”œâ”€â”€ .env.example
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  REST API    â”‚     â”‚   GraphQL    â”‚     â”‚
â”‚  â”‚  (Handler)   â”‚     â”‚  (Resolver)  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Service Layer                     â”‚
â”‚         (Business Logic)                    â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚        â”‚ TaskService  â”‚                     â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Domain Layer                       â”‚
â”‚        (Business Rules)                     â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚        â”‚    Task      â”‚                     â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Repository Layer                    â”‚
â”‚        (Data Access)                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚    â”‚  TaskRepository      â”‚                â”‚
â”‚    â”‚  - Memory (current)  â”‚                â”‚
â”‚    â”‚  - PostgreSQL (TODO) â”‚                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ å„å±¤ã®è²¬å‹™

### 1. **cmd/api**
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
- ä¾å­˜é–¢ä¿‚ã®åˆæœŸåŒ–ã¨æ³¨å…¥
- ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

### 2. **internal/domain**
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’å«ã‚€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ä¾å­˜ã—ãªã„ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ãƒãƒªãƒ¥ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

### 3. **internal/service**
- ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ãƒªãƒã‚¸ãƒˆãƒªã‚’çµ„ã¿åˆã‚ã›ãŸãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†

### 4. **internal/repository**
- ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã®æŠ½è±¡åŒ–
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨å®Ÿè£…ã‚’åˆ†é›¢
- ç¾åœ¨: In-Memoryå®Ÿè£…
- å°†æ¥: PostgreSQLå®Ÿè£…

### 5. **internal/handler** (REST API)
- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å¤‰æ›
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 6. **pkg/graph** (GraphQL)
- GraphQLã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©
- ãƒªã‚¾ãƒ«ãƒãƒ¼ã®å®Ÿè£…
- gqlgenã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ

### 7. **internal/router**
- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
- ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¨­å®š
- REST ã¨ GraphQL ã®çµ±åˆ

### 8. **internal/infrastructure**
- å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
- å¤–éƒ¨API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### REST API ã®å ´åˆ
```
HTTP Request
    â†“
Handler (internal/handler)
    â†“
Service (internal/service)
    â†“
Domain Model (internal/domain)
    â†“
Repository (internal/repository)
    â†“
Database
```

### GraphQL ã®å ´åˆ
```
GraphQL Query/Mutation
    â†“
Resolver (pkg/graph/resolver)
    â†“
Service (internal/service)
    â†“
Domain Model (internal/domain)
    â†“
Repository (internal/repository)
    â†“
Database
```

---

## ğŸš€ GraphQL ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ

### gqlgen ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. **ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```bash
go get github.com/99designs/gqlgen
go get github.com/99designs/gqlgen/graphql/handler
go get github.com/99designs/gqlgen/graphql/playground
```

2. **GraphQL ã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆ**
```bash
cd pkg/graph
go run github.com/99designs/gqlgen generate
```

3. **ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«**
- `pkg/graph/generated/generated.go` - GraphQLã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè£…
- `pkg/graph/model/models_gen.go` - GraphQLå‹ã®Goãƒ¢ãƒ‡ãƒ«
- `pkg/graph/resolver/schema.resolvers.go` - ãƒªã‚¾ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ãƒ–

---

## ğŸ“ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### REST API

#### Health Check
```http
GET /health
GET /api/health
```

#### Tasks
```http
GET /tasks
GET /api/tasks
POST /api/tasks
```

### GraphQL

#### Playground
```
GET /playground
```

#### Query Endpoint
```
POST /query
```

#### ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¨ãƒª

**ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’å–å¾—**
```graphql
query {
  tasks {
    id
    title
    description
    completed
    createdAt
    updatedAt
  }
}
```

**ç‰¹å®šã®ã‚¿ã‚¹ã‚¯ã‚’å–å¾—**
```graphql
query {
  task(id: "1") {
    id
    title
    description
    completed
  }
}
```

**ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ**
```graphql
mutation {
  createTask(input: {
    title: "New Task"
    description: "Task description"
  }) {
    id
    title
    description
    completed
    createdAt
  }
}
```

**ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°**
```graphql
mutation {
  updateTask(
    id: "1"
    input: {
      title: "Updated Title"
      completed: true
    }
  ) {
    id
    title
    completed
    updatedAt
  }
}
```

**ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤**
```graphql
mutation {
  deleteTask(id: "1")
}
```

---

## ğŸ”§ é–‹ç™ºã‚¬ã‚¤ãƒ‰

### æ–°ã—ã„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è¿½åŠ æ‰‹é †

1. **ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©** (`internal/domain/`)
2. **ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©** (`internal/repository/`)
3. **ã‚µãƒ¼ãƒ“ã‚¹å±¤ã‚’å®Ÿè£…** (`internal/service/`)
4. **GraphQLã‚¹ã‚­ãƒ¼ãƒã‚’æ›´æ–°** (`pkg/graph/schema/schema.graphql`)
5. **gqlgen ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ**
6. **ãƒªã‚¾ãƒ«ãƒãƒ¼ã‚’å®Ÿè£…** (`pkg/graph/resolver/`)
7. **(ã‚ªãƒ—ã‚·ãƒ§ãƒ³) REST ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¿½åŠ ** (`internal/handler/`)

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- **Domain**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
- **Service**: ãƒ¢ãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½¿ç”¨
- **Handler**: HTTPãƒ†ã‚¹ãƒˆ
- **Resolver**: GraphQLãƒªã‚¾ãƒ«ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆ

### çµ±åˆãƒ†ã‚¹ãƒˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å«ã‚€ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
- ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠ (testcontainers) ã®ä½¿ç”¨

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å®Ÿè£…äºˆå®š

1. **èªè¨¼**
   - JWT ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼
   - GraphQL ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– `@auth`

2. **èªå¯**
   - ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ (RBAC)
   - ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ã®æ¨©é™ãƒã‚§ãƒƒã‚¯

3. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
   - å…¥åŠ›å€¤ã®æ¤œè¨¼
   - GraphQL ã‚¹ã‚­ãƒ¼ãƒãƒ¬ãƒ™ãƒ«ã§ã®åˆ¶ç´„

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [gqlgen Documentation](https://gqlgen.com/)
- [Go Project Layout](https://github.com/golang-standards/project-layout)
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Domain-Driven Design](https://martinfowler.com/tags/domain%20driven%20design.html)
